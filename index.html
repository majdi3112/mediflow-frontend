<button id="btn">🎙️ Start</button>
<pre id="live"></pre>
<script>
let socket, recorder;

document.getElementById("btn").onclick = async () => {
  if (!recorder) { start(); } else { stop(); }
};
async function start() {
  socket = io("wss://1847-35-233-211-24.ngrok-free.app/socket.io");
  socket.emit("start");
  socket.on("partial", t => document.getElementById("live").textContent = t);
  socket.on("soep"   , t => alert("SOEP klaar:\n" + t));

  const stream = await navigator.mediaDevices.getUserMedia({audio:true});
  recorder = new MediaRecorder(stream, {mimeType:"audio/webm"});
  recorder.ondataavailable = e => socket.emit("chunk", e.data);
  recorder.start(1000);  // ⬅️ 1 s timeslice  == ~16 kB
  document.getElementById("btn").textContent = "⏹️ Stop";
}
function stop() {
  recorder.stop(); recorder = null;
  socket.emit("stop");
  document.getElementById("btn").textContent = "🎙️ Start";
}
</script>
