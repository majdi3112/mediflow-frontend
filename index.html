<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f8fafc; }
    .expanding-textarea {
      min-height: 160px;
      max-height: 640px;
      overflow-y: auto;
      resize: none;
      padding: 1rem 1rem 4rem;
    }
    .formatted-output {
      background: transparent;
      border: none;
      box-shadow: none;
      padding: 0;
    }
    .scrollable-box {
      max-height: 240px;
      overflow-y: auto;
      background: transparent;
      padding: 0;
    }
    .text-red { color: red; font-weight: bold; }
    .text-orange { color: orange; font-weight: bold; }
    .text-yellow { color: goldenrod; font-weight: bold; }
    .text-purple { color: purple; font-weight: bold; }
    .fade-in { opacity: 0; animation: fadeIn 0.5s ease-out forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    .formatted-output ul { display: block; margin:0 0 .75rem 1.5rem; padding:0; }
    .formatted-output li { display:list-item; margin-bottom:.5rem; }
    .formatted-output ul ul { margin-left:1rem; margin-bottom:.5rem; }
  </style>
</head>
<body class="h-screen flex flex-col">
  <header class="flex items-center justify-between px-6 py-4 bg-white shadow">
    <div class="flex items-center space-x-3">
      <img src="https://tailwindcss.com/_next/static/media/tailwindcss-logotype.6c5ae7bd8ebde34f1fc9b11107c1b830.svg" alt="Logo" class="h-8">
      <span class="text-xl font-semibold text-gray-700">medical transcription assistant</span>
    </div>
  </header>
  <main class="flex-1 px-8 py-10 flex flex-col items-center">
    <div class="mt-8 bg-white p-6 rounded-3xl shadow-sm border border-gray-200 w-2/3 mx-auto">
      <div class="relative">
        <textarea id="text-input" placeholder="Hier typen..."
          class="w-full p-4 text-lg placeholder-gray-400 bg-transparent outline-none expanding-textarea"></textarea>
        <span id="settings-btn"
          class="absolute top-4 right-4 text-gray-400 text-xl cursor-pointer">⚙️</span>
      </div>
      <button id="whisper-btn"
        class="mt-4 px-4 py-2 bg-blue-100 text-blue-700 rounded-full shadow hover:bg-blue-200 transition inline-flex items-center">
        🎙️ Start Opname
      </button>
    </div>
    <div class="mt-6 flex justify-center">
      <button id="generate-soep"
        class="px-8 py-3 bg-gray-200 text-gray-700 rounded-full shadow hover:bg-gray-300 font-medium">
        SOEP
      </button>
    </div>
    <div id="verslag-container" class="mt-8 w-2/3 space-y-6 hidden">
      <template id="section-template">
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-200 fade-in">
          <h3 class="text-xl font-semibold mb-4">LETTER</h3>
          <div class="relative">
            <div class="scrollable-box">
              <div class="formatted-output text-lg leading-relaxed"></div>
            </div>
            <button class="absolute bottom-4 right-4 px-2 py-1 bg-gray-100 text-gray-700 rounded-full shadow">📋</button>
          </div>
        </div>
      </template>
      <div id="s-box"></div>
      <div id="o-box"></div>
      <div id="e-box"></div>
      <div id="p-box"></div>
    </div>
  </main>
  <script>
    function formatBullets(text) {
      const parts = text.replace(/-\\s*/g,'• ').split('•').slice(1);
      let html = '<ul class="list-disc pl-6 mb-4">';
      parts.forEach(part => {
        let item = part.trim();
        item = item
          .replace(/🔴\\s*(.+?)\\s*🔴/g, '<span class="text-red">$1</span>')
          .replace(/🟠\\s*(.+?)\\s*🟠/g, '<span class="text-orange">$1</span>')
          .replace(/🟡\\s*(.+?)\\s*🟡/g, '<span class="text-yellow">$1</span>')
          .replace(/🟣\\s*(.+?)\\s*🟣/g, '<span class="text-purple">$1</span>');
        html += `<li class="mb-2">${item}</li>`;
      });
      html += '</ul>';
      return html;
    }
    function createSection(letter, content) {
      const tmpl = document.getElementById('section-template');
      const clone = tmpl.content.cloneNode(true);
      clone.querySelector('h3').textContent = letter;
      clone.querySelector('.formatted-output').innerHTML = formatBullets(content);
      clone.querySelector('button').onclick = () => {
        navigator.clipboard.writeText(clone.querySelector('.formatted-output').innerText);
      };
      return clone;
    }
    document.getElementById('generate-soep').addEventListener('click', () => {
      const sample = "- Punt één - Punt twee - Punt drie";
      ['S','O','E','P'].forEach(letter => {
        const box = document.getElementById(letter.toLowerCase()+'-box');
        box.innerHTML = '';
        box.appendChild(createSection(letter, sample));
      });
      const vc = document.getElementById('verslag-container');
      vc.classList.remove('hidden');
      vc.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
    document.querySelectorAll('.expanding-textarea').forEach(textarea => {
      const max = 640;
      function adjust() {
        textarea.style.height = 'auto';
        const h = Math.min(textarea.scrollHeight, max);
        textarea.style.height = h+'px';
        textarea.style.overflowY = textarea.scrollHeight>max ? 'auto' : 'hidden';
      }
      textarea.addEventListener('input', adjust);
      adjust();
    });
  </script>
</body>
</html>
