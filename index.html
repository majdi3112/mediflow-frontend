<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Consultium Live Transcriptie</title>
  <!-- 1️⃣  Socket.IO-client -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body class="p-4">
  <button id="btn">🎙️ Start</button>
  <pre id="live" style="white-space: pre-wrap; border:1px solid #ccc; padding:1rem; margin-top:1rem;"></pre>

<script>
const WS_URL = "wss://2201-35-203-170-67.ngrok-free.app/socket.io";
let socket, recorder;

async function start() {
  socket = io(WS_URL, { transports: ["websocket"] });
  socket.on("connect",   ()    => console.log("🔌 verbonden"));
  socket.on("status",    m     => console.log("status:", m));
  socket.on("partial",   t     => document.getElementById("live").textContent = t);
  socket.on("final",     t     => {
      console.log("final:", t);
      document.getElementById("live").textContent = t;
  });
  socket.on("soep",      s     => alert("SOEP:\n\n"+s));

  socket.emit("start");
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  recorder = new MediaRecorder(stream, { mimeType: "audio/webm;codecs=opus" });
  recorder.ondataavailable = e => {
    if (e.data.size>0) e.data.arrayBuffer().then(ab => socket.emit("chunk", ab));
  };
  recorder.start(1000);   // **1 s** slices i.p.v. 10 s
}

function stop() {
  recorder.stop();
  socket.emit("stop");
  recorder = null;
}
document.getElementById("btn").onclick = () => recorder ? stop() : start();
</script>

</body>
</html>
